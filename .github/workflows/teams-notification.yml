name: Teams Notification

on:
  workflow_call:
    inputs:
      environment_name:
        description: 'Environment that was deployed to'
        required: true
        type: string
      sql_script:
        description: 'Path to the SQL script that was deployed'
        required: true
        type: string
      status:
        description: 'Deployment status (success/failure)'
        required: true
        type: string
    secrets:
      webhookUrl:
        description: 'Teams webhook URL'
        required: true

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Teams
        uses: neonidian/teams-notify-build-status@v3
        with:
          webhookUrl: ${{ secrets.webhookUrl }}
          title: "ğŸš€ Deployment Complete! Environment: ${{ inputs.environment_name }}"
          titleBackgroundColor: 'green'
          status: 'Deployed'
          message: >-
            ğŸŠ **SQL Deployment Just Landed!** ğŸŠ
            -------------------------------------------
            
            âœ… **Environment:** `${{ inputs.environment_name }}` 
            
            ğŸ“„ **Script Deployed:** `${{ inputs.sql_script }}`  
            
            ğŸ§‘â€ğŸ’» **Deployed by:** `${{ github.actor }}`  
            
            ğŸ”— **[Check out the Workflow Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})**

            ğŸ¥³ SQL Script successfully deployed!!
        env:
          SHOULD_DISPLAY_ACTOR_LABEL: true
          SHOULD_DISPLAY_VIEW_RUN_BUTTON: true
